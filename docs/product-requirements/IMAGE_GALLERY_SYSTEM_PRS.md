# Спецификация Требований: Система Галереи Изображений

**Версия:** 1.1 (Русская редакция)
**Дата:** 15.09.2025
**Автор:** Gemini (Product Manager)

---

## 1. Обзор

Этот документ описывает требования к продукту для Системы Галереи Изображений. Цель — предоставить централизованную систему для управления и использования изображений на всей платформе Beauty Platform, в первую очередь для портфолио салонов, примеров услуг и профилей мастеров. Существующий `Images API` будет служить бэкендом для этой системы.

## 2. Пользовательские Истории (User Stories)

- **Как Владелец Салона,** я хочу загружать изображения работ моего салона для создания портфолио.
- **Как Владелец Салона,** я хочу привязывать изображения к конкретным услугам, чтобы показывать примеры клиентам.
- **Как Владелец Салона,** я хочу назначать фотографию профиля каждому из моих сотрудников.
- **Как Супер-Админ,** я хочу иметь возможность просматривать и модерировать все загруженные изображения, чтобы убедиться, что они соответствуют правилам платформы.
- **Как Разработчик,** я хочу иметь простой и безопасный способ запрашивать и отображать изображения в различных частях приложения (CRM, Клиентский Портал, Публичные Сайты).

## 3. Функциональные Требования

### 3.1. Загрузка Изображений
-   Компонент для загрузки изображений должен быть доступен в CRM-системе салона.
-   **Поддерживаемые форматы:** `JPEG`, `PNG`, `WEBP`.
-   **Ограничение по размеру:** Разумное ограничение на размер одного изображения (например, 5 МБ) должно применяться как на фронтенде, так и на бэкенде.
-   **Обработка изображений:** `Images API` должен автоматически:
    -   Очищать изображения для удаления вредоносных метаданных.
    -   Создавать несколько оптимизированных версий (например, миниатюру, среднюю, большую) для повышения производительности.

### 3.2. Управление Галереей (в CRM)
-   Новый раздел "Галерея" в CRM-системе.
-   **Просмотр:** Сеточный вид всех изображений, загруженных салоном.
-   **Удаление:** Возможность удалять изображения. Удаление изображения должно либо убирать его из всех связей, либо показывать предупреждение, если оно в данный момент используется.
-   **Тегирование/Привязка:**
    -   При просмотре изображения владелец должен иметь возможность привязать его к одной или нескольким `Услугам`.
    -   При редактировании `Сотрудника` владелец должен иметь возможность выбрать изображение из галереи в качестве его фотографии профиля.

### 3.3. Модерация Изображений (в Админ-Панели)
-   Новый раздел "Модерация Изображений" для Супер-Админов.
-   Просмотр недавно загруженных изображений из всех салонов.
-   Возможность для Супер-Админа удалить изображение, нарушающее политику платформы.

## 4. Нефункциональные Требования

-   **Производительность:** Изображения должны раздаваться через CDN (если доступно) или с помощью эффективной стратегии кэширования для обеспечения быстрой загрузки.
-   **Хранение:** Все изображения должны храниться в выделенном, безопасном хранилище (например, S3-совместимое объектное хранилище, такое как MinIO, на что есть намек в схеме портов).
-   **Безопасность:** `Images API` должен гарантировать, что только авторизованные пользователи могут загружать или удалять изображения для своего собственного салона.

## 5. Точки Интеграции

-   **Images API (`service:images-api`, порт 6026):** Является основным бэкендом для всей функциональности. Потребуются новые эндпоинты:
    -   `POST /api/images/upload` (обработка загрузки, обработки и хранения файлов).
    -   `GET /api/images/salon/{salonId}` (получение всех изображений для салона).
    -   `DELETE /api/images/{imageId}` (удаление изображения).
    -   `POST /api/images/associate` (для связи изображения с услугой или сотрудником).
-   **Salon CRM:** Требуется новый UI для галереи и функции загрузки.
-   **Admin Panel:** Требуется новый UI для очереди модерации.

## 6. Что не входит в версию 1.0

-   Редактирование изображений (обрезка, поворот, фильтры).
-   Поддержка видео.
-   Загрузка изображений клиентами (например, загрузка фото для вдохновения).
-   AI-тегирование или категоризация изображений.