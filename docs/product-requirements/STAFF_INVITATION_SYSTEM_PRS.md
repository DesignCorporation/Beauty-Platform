# Спецификация Требований: Система Приглашения Мастеров

**Версия:** 1.1 (Русская редакция)
**Дата:** 15.09.2025
**Автор:** Gemini (Product Manager)

---

## 1. Обзор

Этот документ описывает требования к продукту для Системы Приглашения Мастеров. Цель — создать интуитивный и надежный механизм, позволяющий Владельцам Салонов приглашать новых сотрудников для работы на платформе Beauty Platform.

Система учитывает три типа мастеров, сложную модель доступа к нескольким салонам и использует существующую backend-инфраструктуру (`Invitation`, `UserSalonAccess`).

## 2. Ключевые Концепции

- **Типы Мастеров:**
  -   **Мастер-Владелец:** Создатель салона, имеет полные права.
  -   **Мастер-Сотрудник (мульти-салон):** Существующий на платформе мастер, который может быть приглашен в несколько салонов и переключаться между ними.
  -   **Новый мастер:** Пользователь, у которого еще нет аккаунта на платформе.
- **Модель Оплаты:** Владелец платит за салон (€50/€70), все приглашенные мастера работают в рамках этой подписки бесплатно.
- **Управление Конфликтами:** Система должна проверять занятость мастера во всех салонах, к которым у него есть доступ, чтобы избежать двойного бронирования.

## 3. Пользовательские Истории (User Stories)

- **Как Владелец Салона,** я хочу приглашать новых сотрудников по email, чтобы они могли присоединиться к моему салону.
- **Как Владелец Салона,** я хочу назначать роль (например, 'Мастер', 'Администратор') приглашенному сотруднику для корректного распределения прав.
- **Как Владелец Салона,** я хочу видеть статусы всех приглашений (В ожидании, Принято, Просрочено), чтобы отслеживать, кто присоединился.
- **Как Владелец Салона,** я хочу иметь возможность отозвать приглашение, которое еще не было принято.
- **Как Мастер-Сотрудник,** я хочу иметь возможность работать в нескольких салонах и легко переключаться между ними через `Salon Switcher` в интерфейсе CRM.
- **Как Новый Мастер,** я хочу получить email-приглашение с четкой ссылкой для регистрации и автоматического присоединения к салону.

## 4. Рабочий Процесс (Workflow)

1.  **Инициация:** Владелец Салона в разделе "Команда" CRM нажимает "Пригласить мастера".
2.  **Форма Приглашения:** Владелец заполняет форму:
    -   `Email` приглашаемого
    -   `Имя`
    -   `Роль` (выпадающий список: 'Мастер', 'Администратор', 'Менеджер')
3.  **Отправка:** Система генерирует уникальный токен, создает запись `Invitation` со статусом `PENDING` и отправляет HTML-письмо на указанный email.
4.  **Принятие:** Приглашенный пользователь нажимает на ссылку в письме.
    -   **Сценарий А (Новый мастер):** Переходит на страницу регистрации. После создания аккаунта автоматически привязывается к салону через `UserSalonAccess`.
    -   **Сценарий Б (Мастер-Сотрудник):** Переходит на страницу входа. После авторизации получает уведомление с предложением присоединиться к новому салону. При подтверждении создается новая запись в `UserSalonAccess`.
5.  **Завершение:** Статус приглашения обновляется. Владелец видит нового сотрудника в списке команды. Мастер-Сотрудник видит новый салон в своем `Salon Switcher`.

## 5. Требования к UI

-   **Salon Switcher:** В `header` CRM должен быть добавлен компонент для быстрого переключения между салонами для пользователей с множественным доступом.
-   **Форма Приглашения:** Интуитивно понятная форма в разделе "Команда".
-   **Email Шаблон:** Профессионально сверстанное HTML-письмо для приглашений.

## 6. Требования к API (Endpoints)

-   `POST /api/salons/{salonId}/invitations`: Создание и отправка нового приглашения.
-   `GET /api/salons/{salonId}/invitations`: Получение списка всех приглашений для салона.
-   `DELETE /api/salons/{salonId}/invitations/{invitationId}`: Отзыв приглашения.
-   `POST /api/invitations/{token}/accept`: Принятие приглашения (для нового или существующего пользователя).
-   `GET /api/users/{userId}/salon-access`: Получение списка салонов, к которым у пользователя есть доступ.

## 7. Требования к Безопасности

-   Токены приглашений должны быть одноразовыми, безопасными и иметь ограниченный срок действия (7 дней).
-   Пользователь не может принять приглашение, если оно было отозвано или срок его действия истек.

## 8. Что не входит в версию 1.0

-   Повторная отправка приглашений.
-   Кастомизация текста email-приглашений.
-   Приглашения по номеру телефона (SMS).