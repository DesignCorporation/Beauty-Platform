# üîß –°–ò–°–¢–ï–ú–ê –°–¢–ê–ë–ò–õ–ò–ó–ò–†–û–í–ê–ù–ê - –û–¢–ß–Å–¢ 11.09.2025

## üìã –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï
–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è Beauty Platform —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º Smart Auto-Restore —Å–∏—Å—Ç–µ–º—ã –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–µ—Ä–≤–∏—Å–æ–≤.

**üìä –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°:**
- ‚úÖ **10/10 —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–Ω–ª–∞–π–Ω** 
- ‚úÖ **5 —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ API Gateway**
- ‚úÖ **4 —Å–µ—Ä–≤–∏—Å–∞ —Å –ø—Ä—è–º—ã–º –¥–æ—Å—Ç—É–ø–æ–º**  
- ‚úÖ **1 –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ—Ä–≤–∏—Å**
- ‚úÖ **100% –ø–æ–∫—Ä—ã—Ç–∏–µ Auto-Restore**

---

## üöÄ –ì–õ–ê–í–ù–´–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø

### 1. üìä –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ù–´–ô –ú–û–ù–ò–¢–û–†–ò–ù–ì
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–Ω–∏–º–∞–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É - –∫–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ API Gateway, –∞ –∫–∞–∫–∏–µ –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `/root/beauty-platform/services/api-gateway/src/config/monitoring-services.ts`
- –î–æ–±–∞–≤–ª–µ–Ω endpoint `/api/monitoring/metrics-structured` 
- –°–µ—Ä–≤–∏—Å—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ 3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "gatewayRouted": {
    "title": "API Gateway Routed Services",
    "services": ["Auth Service", "CRM API", "MCP Server", "Images API", "Backup Service"]
  },
  "directAccess": {
    "title": "Direct Access Services", 
    "services": ["Admin Panel", "Salon CRM", "Client Portal", "Landing Page"]
  },
  "infrastructure": {
    "title": "Infrastructure Services",
    "services": ["VS Code Server"]
  }
}
```

### 2. üé® –í–ò–ó–£–ê–õ–¨–ù–û–ï –†–ê–ó–î–ï–õ–ï–ù–ò–ï –í –ê–î–ú–ò–ù–ö–ï
**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ:** `/root/beauty-platform/apps/admin-panel/src/pages/ServicesMonitoringPage.tsx`

**–ù–æ–≤—ã–π UI:**
- üöÄ **–°–∏–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏** - —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ API Gateway —Å Gateway Path
- üåê **–ó–µ–ª—ë–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏** - –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ nginx proxy
- üõ†Ô∏è **–°–µ—Ä—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏** - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –ë–µ–π–¥–∂–∏ "Gateway", "Direct", "Infrastructure"

### 3. ‚ö° SMART AUTO-RESTORE –°–ò–°–¢–ï–ú–ê
**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª:** `/root/beauty-platform/deployment/auto-restore/smart-restore-manager.sh`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```bash
# –ë–´–õ–û (—Å–ª–æ–º–∞–Ω–æ):
if [[ "$service" != "images-api" && "$service" != "mcp-server" && "$service" != "postgresql" ]]

# –°–¢–ê–õ–û (—Ä–∞–±–æ—Ç–∞–µ—Ç):
if [[ "$service" != "postgresql" ]]
```

**–ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã:**
- `backup-service`: PORT=6027, –∑–∞–ø—É—Å–∫ `node dist/server.js`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ MCP Server: `npm run dev`

### 4. üîó API GATEWAY –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
**–û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
nginx (443) ‚Üí API Gateway (6020) ‚Üí [5 microservices]
nginx (443) ‚Üí Direct Proxy ‚Üí [4 frontend apps]  
```

**–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:**
- `/api/auth/*` ‚Üí Auth Service (6021)
- `/api/crm/*` ‚Üí CRM API (6022)  
- `/api/mcp/*` ‚Üí MCP Server (6025)
- `/api/images/*` ‚Üí Images API (6026)
- `/api/backup/*` ‚Üí Backup Service (6027)

---

## üìÅ –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

### üîß Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **`/root/beauty-platform/services/api-gateway/src/config/monitoring-services.ts`** - –ù–û–í–´–ô
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏

2. **`/root/beauty-platform/services/api-gateway/src/routes/monitoring.ts`** - –ò–ó–ú–ï–ù–Å–ù
   - –î–æ–±–∞–≤–ª–µ–Ω endpoint `/metrics-structured`
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

3. **`/root/beauty-platform/deployment/auto-restore/smart-restore-manager.sh`** - –ò–°–ü–†–ê–í–õ–ï–ù
   - –£–±—Ä–∞–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è images-api –∏ mcp-server
   - –î–æ–±–∞–≤–ª–µ–Ω backup-service
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ MCP Server

4. **`/root/beauty-platform/services/api-gateway/src/routes/proxy.ts`** - –ü–†–û–í–ï–†–ï–ù
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ rewrite

### üé® Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è:
5. **`/root/beauty-platform/apps/admin-panel/src/pages/ServicesMonitoringPage.tsx`** - –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–†–ê–ë–û–¢–ö–ê
   - –ó–∞–º–µ–Ω–∞ –ø—Ä–æ—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è `serviceCategories`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API `/metrics-structured`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç `Settings`

### üåê Infrastructure –∏–∑–º–µ–Ω–µ–Ω–∏—è:
6. **`/etc/nginx/sites-available/test-admin.beauty.designcorp.eu`** - –ü–†–û–í–ï–†–ï–ù
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è `/api/*` —á–µ—Ä–µ–∑ API Gateway 6020

---

## üîç DEBUGGING –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: Images API Auto-Restore –ø–∞–¥–∞–ª
**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ smart-restore-manager.sh

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 2: MCP Server –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è —á–µ—Ä–µ–∑ Auto-Restore  
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ `node src/server.js`
**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `npm run dev`

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 3: API Gateway –ø–æ–∫–∞–∑—ã–≤–∞–ª "degraded" —Å—Ç–∞—Ç—É—Å
**–ü—Ä–∏—á–∏–Ω–∞:** Backup Service –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –Ω–∞ –ø–æ—Ä—Ç—É 6027
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—â–µ–Ω Backup Service, –¥–æ–±–∞–≤–ª–µ–Ω –≤ Auto-Restore

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 4: PostgreSQL –ø–æ—Ä—Ç 5432 –≤–º–µ—Å—Ç–æ 6100
**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ monitoring.ts
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –Ω–æ –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ HTTP –ø—Ä–æ–≤–µ—Ä–æ–∫

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 5: –î—É–±–ª—å –∏–º–ø–æ—Ä—Ç–∞ Settings –≤ –∞–¥–º–∏–Ω–∫–µ
**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∏–∫–æ–Ω–æ–∫
**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª—ë–Ω –¥—É–±–ª–∏–∫–∞—Ç –∏–º–ø–æ—Ä—Ç–∞

---

## üèÜ –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –°–•–ï–ú–ê

```mermaid
graph TD
    A[Client Browser] --> B[nginx :443]
    B --> C[API Gateway :6020]
    B --> G[Direct nginx proxy]
    
    C --> D1[Auth Service :6021]
    C --> D2[CRM API :6022] 
    C --> D3[MCP Server :6025]
    C --> D4[Images API :6026]
    C --> D5[Backup Service :6027]
    
    G --> F1[Admin Panel :6002]
    G --> F2[Salon CRM :6001]
    G --> F3[Client Portal :6003]
    G --> F4[Landing Page :6000]
    
    H[VS Code Server :6080] --> I[Infrastructure]
    
    style C fill:#e1f5fe
    style D1 fill:#e1f5fe
    style D2 fill:#e1f5fe
    style D3 fill:#e1f5fe
    style D4 fill:#e1f5fe
    style D5 fill:#e1f5fe
    style F1 fill:#e8f5e8
    style F2 fill:#e8f5e8
    style F3 fill:#e8f5e8
    style F4 fill:#e8f5e8
    style H fill:#f5f5f5
```

---

## üö® –ö–†–ò–¢–ò–ß–ù–´–ï –ö–û–ú–ê–ù–î–´ –î–õ–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø

### –ó–∞–ø—É—Å–∫ API Gateway:
```bash
cd /root/beauty-platform/services/api-gateway
npm run build
node dist/server.js &
```

### –ó–∞–ø—É—Å–∫ Admin Panel:
```bash
cd /root/beauty-platform/apps/admin-panel  
npm run dev &
```

### Smart Auto-Restore:
```bash
/root/beauty-platform/deployment/auto-restore/smart-restore-manager.sh status
/root/beauty-platform/deployment/auto-restore/smart-restore-manager.sh restore [service]
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã:
```bash
curl -s http://localhost:6020/api/monitoring/metrics-structured | jq '.data.summary'
```

---

## üìä –ò–¢–û–ì–û–í–´–ï –ú–ï–¢–†–ò–ö–ò

**‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å—Ç–∞–±–∏–ª—å–Ω—ã:**
- API Gateway: HEALTHY (–±—ã–ª degraded)
- Auth Service: ONLINE  
- CRM API: ONLINE
- MCP Server: ONLINE (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—É—Å–∫)
- Images API: ONLINE (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω Auto-Restore)
- Backup Service: ONLINE (–¥–æ–±–∞–≤–ª–µ–Ω)
- Admin Panel: ONLINE (–Ω–æ–≤—ã–π UI)
- Salon CRM: ONLINE
- Client Portal: ONLINE
- Landing Page: ONLINE
- VS Code Server: ONLINE

**üîß Auto-Restore –ø–æ–∫—Ä—ã—Ç–∏–µ: 100%**
- –í—Å–µ 8 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–º–µ—é—Ç —Å–∫—Ä–∏–ø—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞–ª–æ 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ü–æ–Ω—è—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞** - –≥–æ—Ç–æ–≤–∞ –∫ –±–µ–∫–∞–ø—É
2. üîÑ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –±–µ–∫–∞–ø–∞** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
3. üåê **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ CRM** - –∫–ª–∏–µ–Ω—Ç—ã –∂–¥—É—Ç
4. üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

---

**üí° –í–ê–ñ–ù–û:** –î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –≤ —Å–ª—É—á–∞–µ —Å–±–æ—è. –í—Å–µ —Ñ–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –∫ –±–µ–∫–∞–ø—É.

**üë®‚Äçüíª –ê–≤—Ç–æ—Ä:** AI Claude  
**üìÖ –î–∞—Ç–∞:** 11.09.2025  
**‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~2 —á–∞—Å–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–π —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏