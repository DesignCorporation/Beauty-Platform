# üöÄ CRM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø - –°–¢–ê–¢–£–° –ò –î–û–°–¢–ò–ñ–ï–ù–ò–Ø

**–î–∞—Ç–∞:** 24 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–°–ù–û–í–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ!  

## ‚úÖ –ß–¢–û –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û:

### 1. **Nginx Proxy –Ω–∞—Å—Ç—Ä–æ–µ–Ω**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç `/api/crm/*` ‚Üí CRM API (6022)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã CORS headers –∏ proxy headers
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π debug endpoint `/debug/clients/:tenantId`
- **–§–∞–π–ª:** `/etc/nginx/sites-available/test-crm.beauty.designcorp.eu`

### 2. **–ù–æ–≤—ã–π CRM API Backend —Å–æ–∑–¥–∞–Ω**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ –ø–æ—Ä—Ç—É 6022
- ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏: clients, services, appointments, staff
- ‚úÖ Tenant –∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ tenantPrisma(tenantId)
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (middleware –≥–æ—Ç–æ–≤)
- ‚úÖ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è, rate limiting, CORS
- **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `/root/beauty-platform/services/crm-api/`

### 3. **Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- ‚úÖ –•—É–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: `useClients.ts`, `useServices.ts`
- ‚úÖ –ù–æ–≤—ã–π API –∫–ª–∏–µ–Ω—Ç: `crmApiNew.ts`
- ‚úÖ Fallback –Ω–∞ debug endpoint –¥–ª—è –¥–µ–º–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Production URL —á–µ—Ä–µ–∑ nginx proxy

### 4. **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ë–î –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã**
- ‚úÖ **6 –∫–ª–∏–µ–Ω—Ç–æ–≤** –≤ beauty_platform_new
- ‚úÖ **6 —É—Å–ª—É–≥** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏  
- ‚úÖ **44 –∑–∞–ø–∏—Å–∏** –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
- ‚úÖ **6 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** (–≤–ª–∞–¥–µ–ª–µ—Ü + –º–∞—Å—Ç–µ—Ä–∞)
- ‚úÖ Tenant ID: `cmem0a46l00009f1i8v2nz6qz`

### 5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞**
- ‚úÖ SystemIntegrationSection.tsx —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π CRM API
- ‚úÖ –°—Ö–µ–º—ã, endpoints, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ

## üéØ –¢–ï–ö–£–©–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢:

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç 3+ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å–∞–π—Ç–µ** https://test-crm.beauty.designcorp.eu –≤–º–µ—Å—Ç–æ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö!

### –†–µ–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏–∑ –ë–î:
- **–ê–Ω–Ω–∞ –ö–ª–∏–µ–Ω—Ç–æ–≤–∞** - anna@example.com, +7 (915) 123-11-11
- **–ú–∞—Ä–∏—è –ü–æ–∫—É–ø–∞—Ç–µ–ª—å** - maria@example.com, +7 (915) 123-22-22  
- **–ï–ª–µ–Ω–∞ –ö—Ä–∞—Å–æ—Ç–∫–∞** - elena@example.com, +7 (915) 123-33-33
- **–û–ª—å–≥–∞ –°—Ç–∏–ª—å–Ω–∞—è** - olga@example.com
- **–°–≤–µ—Ç–ª–∞–Ω–∞ –ú–æ–¥–Ω–∞—è** - svetlana@example.com

## üîß –ß–¢–û –û–°–¢–ê–õ–û–°–¨ –î–û–î–ï–õ–ê–¢–¨:

### 1. **JWT –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚ö†Ô∏è
**–ü—Ä–æ–±–ª–µ–º–∞:** JsonWebTokenError: invalid signature  
**–ü—Ä–∏—á–∏–Ω–∞:** –í–æ–∑–º–æ–∂–Ω–æ —Ä–∞–∑–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–¥–ø–∏—Å–∏ –∏–ª–∏ timing issues  
**–†–µ—à–µ–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É Auth Service –∏ CRM API  

### 2. **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è API**
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å services, appointments, staff endpoints
- –£–±—Ä–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π debug endpoint  
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**  
- PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è CRM API
- Environment variables —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- Error handling –∏ logging

## üèóÔ∏è –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:

```
Salon CRM Frontend (6001)
    ‚Üì nginx proxy 
    ‚Üì /api/crm/* ‚Üí CRM API Backend (6022)
    ‚Üì tenantPrisma(tenantId)  
    ‚Üì beauty_platform_new PostgreSQL

‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–∞–ª–æ–Ω–∞–º
‚úÖ httpOnly cookies –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π TypeScript + Zod validation
‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
```

## üìÇ –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ô–õ–´:

### Backend (CRM API):
- `/root/beauty-platform/services/crm-api/src/server.ts` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
- `/root/beauty-platform/services/crm-api/src/middleware/auth.ts` - JWT middleware
- `/root/beauty-platform/services/crm-api/src/routes/clients.ts` - CRUD –∫–ª–∏–µ–Ω—Ç—ã
- `/root/beauty-platform/services/crm-api/.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Frontend:
- `/root/beauty-platform/apps/salon-crm/src/services/crmApiNew.ts` - API –∫–ª–∏–µ–Ω—Ç
- `/root/beauty-platform/apps/salon-crm/src/hooks/useClients.ts` - React —Ö—É–∫–∏
- `/root/beauty-platform/apps/salon-crm/src/hooks/useServices.ts` - React —Ö—É–∫–∏

### Infrastructure:
- `/etc/nginx/sites-available/test-crm.beauty.designcorp.eu` - nginx –∫–æ–Ω—Ñ–∏–≥
- `/root/beauty-platform/apps/admin-panel/src/components/documentation/sections/SystemIntegrationSection.tsx` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üéâ –ì–õ–ê–í–ù–û–ï –î–û–°–¢–ò–ñ–ï–ù–ò–ï:

**–ü–û–õ–ù–û–¶–ï–ù–ù–ê–Ø –ú–ù–û–ì–û–¢–ï–ù–ê–ù–¢–ù–ê–Ø CRM –°–ò–°–¢–ï–ú–ê –ë–ï–ó LEGACY –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô!**

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã beauty_platform_new –Ω–∞ —Å–∞–π—Ç–µ, 
—á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É—Å–ø–µ—à–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –Ω–æ–≤–æ–≥–æ —á–∏—Å—Ç–æ–≥–æ API —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º.

---

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –±–µ–∑ debug endpoint.